<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Several hits</title>

    <link rel="stylesheet" href="general.css">
    <script src="cookies.js"></script>
</head>
<body>
<form  action="/takeDammage" method="get" id="form">
    <div>
        <label for="nbDammage">Dégats Deja pris :</label>
        <input type="number" id="nbDammage" name="dammage" readonly="readonly">
    </div>
    <div>
        <label for="nbDammagetoacc">Dégats :</label>
        <input type="number" id="nbDammagetoacc" name="nbDammagetoacc">
        <button id="testButton" class="button" type="button" onclick="degats();">Esquive ?</button>
    </div>


    <div id="takeOrDodge" >
        <p style="color:red;" id="KO" > KO </p>
        <a href="/chooseCharacter.html" id="choixperso">Choisir un personnage</a>
    </div>
    <div>
        <button id="submitButton" type="submit" style="display:none disabled">Prendre des degats</button>
    </div>
</form>

<script>

    var nameValue= findValueCookie("name");
    var attackValue= findValueCookie("attack");
    var HPValue= findValueCookie("HP");
    var dodgeValue=parseFloat(findValueCookie("dodge"));
    var degaaccu=0;
    document.getElementById("choixperso").style.display = "none";

    document.getElementById("KO").style.display = "none";


function degats(){

   if( document.getElementById("nbDammagetoacc").value!='')
   {

    document.getElementById("testButton").innerHTML= "retirer";
    var dommage =parseFloat(document.getElementById("nbDammagetoacc").value);

    if(dodgeValue<Math.random()){
     if( (degaaccu+dommage)<= parseFloat(HPValue))
     {
     degaaccu+=dommage;
     document.getElementById("nbDammage").value = degaaccu;
     }
     if( 0==parseFloat(HPValue))
     {
         document.getElementById("KO").style.display = "initial";
         document.getElementById("submitButton").disabled= true;
         document.getElementById("choixperso").style.display = "initial";
     }


     console.log("touché");
     } else {

     console.log("ésquive");}

    }
}

</script>

</body>
</html>